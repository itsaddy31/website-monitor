<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>2A’s Monitoring Solution</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
 margin:0;
 font-family:Inter,Arial;
 background:#0B1220;
 color:white;
 display:flex;
}

.sidebar{
 width:230px;
 background:#111827;
 height:100vh;
 padding:20px;
}

.sidebar h2{
 margin:0 0 20px 0;
 font-size:18px;
}

.menu{
 margin:12px 0;
 cursor:pointer;
 color:#9CA3AF;
}
.menu:hover{color:white}

.main{
 flex:1;
 padding:20px;
}

.cards{
 display:grid;
 grid-template-columns:repeat(4,1fr);
 gap:15px;
 margin-bottom:20px;
}

.card{
 background:#111827;
 border-radius:10px;
 padding:15px;
}

.grid{
 display:grid;
 grid-template-columns:1fr 1fr;
 gap:20px;
}

.status{
 padding:10px;
 border-radius:6px;
 margin:5px 0;
}
.up{background:#052e1c;border-left:4px solid #22C55E}
.down{background:#3b0a0a;border-left:4px solid #EF4444}

.small{color:#9CA3AF;font-size:12px}
.section{margin-bottom:20px}

</style>
</head>

<body>

<div class="sidebar">
<h2>2A’s Monitoring</h2>
<div class="menu">Dashboard</div>
<div class="menu">Sites</div>
<div class="menu">Incidents</div>
<div class="menu">Admin</div>
</div>

<div class="main">

<h1>Monitoring Dashboard</h1>

<div class="cards">
<div class="card">
<div class="small">Global SLA</div>
<h2 id="sla">-- %</h2>
</div>

<div class="card">
<div class="small">Total Sites</div>
<h2 id="total">0</h2>
</div>

<div class="card">
<div class="small">Down</div>
<h2 id="downCount">0</h2>
</div>

<div class="card">
<div class="small">Avg Latency</div>
<h2 id="lat">-- ms</h2>
</div>
</div>

<div class="grid">

<div class="card">
<h3>Sites Status</h3>
<div id="sites"></div>
</div>

<div class="card">
<h3>World Latency</h3>
<div id="latency"></div>
</div>

</div>

<div class="section card">
<h3>Response Time</h3>
<canvas id="chart" height="80"></canvas>
</div>

<div class="section card">
<h3>Incidents</h3>
<div id="incidents"></div>
</div>

</div>

<script>

let chart;

async function load(){
 const res=await fetch("/api/demo");
 const data=await res.json();

 document.getElementById("total").innerText=data.length;

 let down=0;
 let slaSum=0;
 let latSum=0;
 let latCount=0;

 const box=document.getElementById("sites");
 box.innerHTML="";

 data.forEach(s=>{
  if(s.status==="down") down++;

  if(s.sla) slaSum+=parseFloat(s.sla);
  if(s.rt){latSum+=s.rt; latCount++;}

  box.innerHTML+=`
   <div class="status ${s.status}">
    ${s.url}
    <div class="small">SLA ${s.sla||0}%</div>
   </div>
  `;
 });

 document.getElementById("downCount").innerText=down;
 document.getElementById("sla").innerText=
  data.length?(slaSum/data.length).toFixed(2):0;

 document.getElementById("lat").innerText=
  latCount?Math.round(latSum/latCount):0;

}

setInterval(load,3000);

async function latency(){
 const res=await fetch("/api/latency");
 const data=await res.json();

 const box=document.getElementById("latency");
 box.innerHTML="";

 data.forEach(r=>{
  box.innerHTML+=`
   <div class="small">${r.region}: ${r.latency||"down"} ms</div>
  `;
 });
}
setInterval(latency,5000);
latency();

</script>

</body>
</html>
